"use strict";angular.module("core",[]),angular.module("core").factory("ProfileService",["FlipConstants",function(e){function a(){return!localStorage.getItem(e.localStorage.showAll)}function s(){return Math.floor(Math.random()*e.gift.length)}function o(){localStorage.setItem(e.localStorage.showAll,e.init.showAllHelp),localStorage.setItem(e.localStorage.hearts,e.init.heartsHelp),localStorage.setItem(e.localStorage.showOne,e.init.showOneHelp),localStorage.setItem(e.localStorage.bestScore,0),localStorage.setItem(e.localStorage.bestScoreFlash,0),localStorage.setItem(e.localStorage.lastDate,(new Date).toDateString())}function l(a){localStorage.setItem(_.result(e.localStorage,a,""),n(a)-1)}function t(a){localStorage.setItem(_.result(e.localStorage,a,""),n(a)+1)}function n(a){return parseInt(localStorage.getItem(_.result(e.localStorage,a,"")))}function i(a){localStorage.setItem(e.localStorage.bestScore,a)}function c(){return parseInt(localStorage.getItem(e.localStorage.bestScore))||0}function d(a){localStorage.setItem(e.localStorage.bestScoreFlash,a)}function r(){return parseInt(localStorage.getItem(e.localStorage.bestScoreFlash))||0}function u(a){localStorage.setItem(e.localStorage.lastDate,a)}function v(){return localStorage.getItem(e.localStorage.lastDate)||(new Date).toDateString()}function m(){return localStorage.getItem(e.localStorage.sound)||!0}function p(a){localStorage.setItem(e.localStorage.sound,a)}return{isFirstUse:a,initLocalStorage:o,setBestScore:i,setBestScoreFlash:d,getBestScore:c,getBestScoreFlash:r,getProperty:n,getLastDate:v,setLastDate:u,propertyDecrement:l,propertyIncrement:t,getSoundState:m,setSoundState:p,generateGift:s}}]),angular.module("core").factory("CardService",["$rootScope",function(e){function a(e){var a,s=Math.random();return a=.34>=s?Math.pow(2,Math.floor(1*s/.34*(Math.log2(e)-1))):.59>=s?1:.84>=s?2:.92>=s?"J":"X"}function s(e,a){for(var s,o,l=e.length,t=a;0!==l;)o=Math.floor(Math.random()*l),l-=1,s=e[l].value,e[l].value=e[o].value,e[o].value=s,l===t?t=o:o===t&&(t=l);return t}function o(e,a){"hide"!==e[a].state&&"showAll"!==e[a].state&&(e[a].state="hide")}function l(a){a.forEach(function(e){"none"!==e.state&&(e.state="hide")}),e.sound&&(e.audios.flip.play(),e.audios.flip.volume=.4)}function t(e,a){e[a].state="none"}function n(a,s){a[s].state="show",e.sound&&(e.audios.flip.play(),e.audios.flip.volume=.4)}function i(e,s,o){e[s].state="showAll"===e[s+1%e.length-1].state?"showAll":"load",r(e,s,a(o))}function c(a){a.forEach(function(e){e.state="showAll"}),e.sound&&(e.audios.flip.play(),e.audios.flip.volume=.4)}function d(e){e.forEach(function(e){e.state="none"})}function r(e,a,s){e[a].value=s}function u(e,a,s,o){return"J"===e[a].value?"J"===e[s].value?2*o:2*e[s].value:"J"===e[s].value?2*e[a].value:e[a].value===e[s].value?2*e[a].value:-1}return{generateCard:a,shuffleCard:s,hideOne:o,hideAll:l,removeOne:t,removeAll:d,showOne:n,loadOne:i,showAll:c,setValue:r,compareTwoCards:u}}]),angular.module("core").controller("PlayController",["$scope","$state","CardService","FlipConstants","ProfileService","$rootScope",function(e,a,s,o,l,t){function n(a){if(m.showOne)s.showOne(m.cards,a),m.showOne=!1,f=!1,m.showAll=!1,m.infoWindow.show=!1,l.propertyDecrement("showOne"),m.showOneDiamonds--,_.delay(function(){s.hideOne(m.cards,a),f=!0,e.$apply()},o.delay.showAllDiamonds);else if(h&&f)if(s.showOne(m.cards,a),"X"===m.cards[a].value){f=!1,h=!1;var t=0,c=o.delay.removeCardOnsuccess;_.delay(function(){s.showAll(m.cards),e.$apply()},c),c+=o.delay.showAllShuffle,_.delay(function(){t=s.shuffleCard(m.cards,a),e.$apply()},c),c+=o.delay.removeCardOnsuccess,_.delay(function(){s.removeOne(m.cards,t),e.$apply()},c),c+=o.delay.generateCardOnsuccess,_.delay(function(){m.cards[t].state="load",g>1&&(m.cards[t].value=g/2),e.$apply()},c),c+=o.delay.hideAllShuffle,_.delay(function(){s.hideAll(m.cards),f=!0,h=!0,p=-1,e.$apply()},c)}else-1===p?p=a:p!==a&&(h=!1,i(p,a));else f&&(s.hideAll(m.cards),h=!0,p=-1,n(a))}function i(a,n){var i,c=s.compareTwoCards(m.cards,a,n,g);-1!==c?(_.delay(function(){s.removeOne(m.cards,a),m.score+=c,m.score>v&&(m.TitleScore="A new High score"),s.setValue(m.cards,n,c),e.$apply(),c>g&&(g=c)},o.delay.removeCardOnsuccess),_.delay(function(){s.loadOne(m.cards,a,g),e.$apply()},o.delay.removeCardOnsuccess+o.delay.generateCardOnsuccess),i=o.delay.hideOnsuccess+o.delay.removeCardOnsuccess+o.delay.generateCardOnsuccess):(m.hearts--,i=o.delay.hideOnError,t.sound&&navigator.vibrate(200),0===m.hearts&&(m.lose=!0,t.sound&&(t.audios.over.play(),t.audios.over.volume=.3),_.delay(function(){s.showAll(m.cards),e.$apply(),m.score>v&&l.setBestScore(m.score)},100),i=0)),_.delay(function(){s.hideOne(m.cards,n),s.hideOne(m.cards,a),p===a&&(p=-1),h=!0,e.$apply()},i)}function c(a){m.showAllDiamonds>0?a?(s.showAll(m.cards),f=!1,m.showAll=!1,l.propertyDecrement("showAll"),m.showAllDiamonds--,_.delay(function(){s.hideAll(m.cards),f=!0,e.$apply()},o.delay.showAllDiamonds)):m.showAll=!0:(m.infoWindow.show=!0,m.infoWindow.content='No "Show All Diamonds" enaugh :( ',_.delay(function(){m.infoWindow.show=!1,e.$apply()},2e3))}function d(){m.showOneDiamonds>0?(m.showOne=!m.showOne,m.infoWindow.show=m.showOne,m.showOne&&(m.infoWindow.content="Choose the card or tap the button again to desactivate it")):(m.infoWindow.show=!0,m.infoWindow.content='No "Show One Diamonds" enaugh :( ',_.delay(function(){m.infoWindow.show=!1,e.$apply()},2e3))}function r(){m.lose=!1,m.hearts=1,_.delay(function(){s.hideAll(m.cards),l.propertyDecrement("hearts"),m.heartsDiamonds--,e.$apply()},700)}function u(){var i=a.params.mode;m.mode={name:i,cards:_.result(o.mode,i,"")},m.cardClicked=n,m.showAllFct=c,m.showOneFct=d,m.continueFct=r,m.cards=[],m.infoWindow={},m.hearts=o.init.hearts,m.score=0,m.lose=!1,m.showAll=!1,m.showOne=!1,m.TitleScore="score",g=1,v=l.getBestScore(),m.showAllDiamonds=l.getProperty("showAll"),m.showOneDiamonds=l.getProperty("showOne"),m.heartsDiamonds=l.getProperty("hearts");var u=Math.pow(m.mode.cards,2);t.sound&&(t.audios.menu.stop(),t.audios.game.play(),t.audios.game.volume=.3,t.audios.game.loop=!0);for(var p=0;u>p;p++)_.delay(function(){m.cards.push({value:o.init.initValue,state:"show"}),e.$apply()},p*o.delay.firstShowDelay);_.delay(function(){s.hideAll(m.cards),e.$apply()},o.delay.firstShowDelay*u+o.delay.firstHideAll)}var v,m=this,p=-1,h=!0,g=1,f=!0;m.init=u,u()}]),angular.module("core").controller("HomeController",["$scope","$rootScope","$state","ProfileService",function(e,a,s,o){function l(){o.initLocalStorage()}function t(e){c.showLevel=e}function n(e,o){c.hideCard=o,a.sound&&a.audios.flip.play(),_.delay(function(){s.go(e,{mode:o})},500)}function i(){c.showLevels=t,c.startGame=n,c.showLevel="",a.audios.game.stop(),a.audios.menu.play(),a.audios.menu.setMuting(!a.sound),a.audios.menu.loop=!0,_.delay(function(){e.$apply(function(){c.showLogo=!0}),a.sound&&(a.audios.logo.play(),a.audios.logo.volume=.4)},500),o.isFirstUse()&&l(),c.score=o.getBestScore(),c.scoreFlash=o.getBestScoreFlash()}var c=this;i()}]),angular.module("core").controller("FlashController",["$scope","$state","CardService","FlipConstants","ProfileService","$rootScope",function(e,a,s,o,l,t){function n(a){if(60===u&&c(!0),p&&g)if(s.showOne(v.cards,a),"X"===v.cards[a].value){g=!1,p=!1;var l=0,t=o.delay.removeCardOnsuccess;_.delay(function(){s.showAll(v.cards),e.$apply()},t),t+=o.delay.showAllShuffle,_.delay(function(){l=s.shuffleCard(v.cards,a),e.$apply()},t),t+=o.delay.removeCardOnsuccess,_.delay(function(){s.removeOne(v.cards,l),e.$apply()},t),t+=o.delay.generateCardOnsuccess,_.delay(function(){v.cards[l].state="load",h>1&&(v.cards[l].value=h/2),e.$apply()},t),t+=o.delay.hideAllShuffle,_.delay(function(){s.hideAll(v.cards),g=!0,p=!0,m=-1,e.$apply()},t)}else-1===m?m=a:m!==a&&(p=!1,i(m,a));else g&&(s.hideAll(v.cards),p=!0,m=-1,n(a))}function i(a,l){var t,n=s.compareTwoCards(v.cards,a,l,h);-1!==n?(_.delay(function(){s.removeOne(v.cards,a),v.score+=n,v.score>r&&(v.TitleScore="A new High score"),s.setValue(v.cards,l,n),""!==v.cards[a].notif&&(u+=v.cards[a].notif),""!==v.cards[l].notif&&(u+=v.cards[l].notif),u>60&&(u=60),e.$apply(),n>h&&(h=n)},o.delay.removeCardOnsuccess),_.delay(function(){if(s.loadOne(v.cards,a,h),v.cards[a].notif="",50>u){var o=Math.random();.15>=o?v.cards[a].notif=2:.25>=o?v.cards[a].notif=5:.3>=o&&(v.cards[a].notif=10)}e.$apply()},o.delay.removeCardOnsuccess+o.delay.generateCardOnsuccess),t=o.delay.hideOnsuccess+o.delay.removeCardOnsuccess+o.delay.generateCardOnsuccess):t=o.delay.hideOnError,_.delay(function(){s.hideOne(v.cards,l),s.hideOne(v.cards,a),m===a&&(m=-1),p=!0,e.$apply()},t)}function c(a){a&&(v.count={min:"00",s:59},u=59),u--,10>u&&(v.timeLeft=!0,e.$apply(),5>u&&t.sound&&(t.audios.bip.play(),t.audios.bip.volume=.4)),0>u?(v.lose=!0,t.sound&&navigator.vibrate(200),s.showAll(v.cards),e.$apply(),v.score>r&&l.setBestScoreFlash(v.score)):_.delay(function(){v.count.s=u,v.timeLeft=!1,e.$apply(),c(!1)},1e3)}function d(){var i=a.params.mode;v.mode={name:i,cards:_.result(o.mode,i,"")},v.cardClicked=n,v.cards=[],v.score=0,v.lose=!1,u=60,v.timeLeft=!1,v.TitleScore="score",h=1,v.count={min:"01",s:0},r=l.getBestScoreFlash(),t.sound&&(t.audios.menu.stop(),t.audios.game.play(),t.audios.game.volume=.3,t.audios.game.loop=!0),v.heartsDiamonds=l.getProperty("hearts");for(var c=Math.pow(v.mode.cards,2),d=0;c>d;d++)_.delay(function(){v.cards.push({value:o.init.initValue,state:"show",notif:""}),e.$apply()},d*o.delay.firstShowDelay);_.delay(function(){s.hideAll(v.cards),e.$apply()},o.delay.firstShowDelay*c+o.delay.firstHideAll)}var r,u,v=this,m=-1,p=!0,h=1,g=!0;v.init=d,d()}]),angular.module("core").constant("FlipConstants",{init:{hearts:3,initValue:1,showAllHelp:2,showOneHelp:2,heartsHelp:2},delay:{firstShowDelay:60,firstHideAll:300,removeCardOnsuccess:400,generateCardOnsuccess:400,hideOnsuccess:400,hideOnError:800,showAllShuffle:800,hideAllShuffle:1200,showAllDiamonds:2e3},gift:[{id:1,name:"showAllDiamonds",localStorage:"showAll",slug:"Show All Diamonds"},{id:2,name:"showOneDiamonds",localStorage:"showOne",slug:"Show One Diamonds"},{id:3,name:"HeartsDiamonds",localStorage:"hearts",slug:"Hearts Diamonds"}],mode:{easy:3,medium:4,hard:5},localStorage:{bestScore:"bestScore",bestScoreFlash:"bestScoreFlash",hearts:"hearts",showOne:"showOne",showAll:"showAll",sound:"sound",lastDate:"lastDate"}}),function(){angular.module("xflip",["core","ui.router","ngIOS9UIWebViewPatch","ngResource","ngAnimate","ngTouch","ngSanitize","ui.bootstrap","ui.utils","ngAudio"])}(),function(){angular.module("xflip").controller("MainController",["$state","ProfileService","FlipConstants","$scope","$rootScope","ngAudio",function(e,a,s,o,l,t){function n(a,s){e.go(a,s)}function i(){var e=a.getLastDate(),l=(new Date).toDateString();if(e!==l){var t=s.gift[a.generateGift()];p.gift=t.slug,a.propertyIncrement(t.localStorage),a.setLastDate(l),_.delay(function(){o.$apply(function(){p.giftModal=!0})},700)}}function c(){p.giftModal=!1}function d(e){e?navigator.app.exitApp():l.exit=!0}function r(){l.exit=!1}function u(){l.sound=!l.sound,a.setSoundState(l.sound),l.audios.menu.setMuting(!l.sound)}function v(){l.sound&&(l.audios.click.play(),l.audios.click.volume=.3)}function m(){p.goToState=n,p.closeGift=c,p.keepInGame=r,p.clickSound=v,p.close=d,l.audios={menu:t.load("assets/sounds/menu.mp3"),flip:t.load("assets/sounds/flap.ogg"),logo:t.load("assets/sounds/flag.mp3"),click:t.load("assets/sounds/click.ogg"),game:t.load("assets/sounds/game.wav"),over:t.load("assets/sounds/over.wav"),bip:t.load("assets/sounds/bip.wav")},l.toggleSound=u,l.sound="true"===a.getSoundState(),i()}var p=this;m()}])}(),angular.module("xflip").constant("configConstantes",{logDebug:"true"}),function(){function e(e,s){e.debug("run"),document.addEventListener("backbutton",function(e){e.preventDefault(),a(s)},!1)}function a(e){"home"===e.current.name?navigator.app.exitApp():e.go("home")}e.$inject=["$log","$state"],angular.module("xflip").run(e)}(),function(){function e(e,a){e.debugEnabled(a.logDebug)}function a(e,a){a.otherwise("/"),a.otherwise("/"),e.state("home",{url:"/",templateUrl:"app/modules/core/views/home.html",controller:"HomeController as vm"}).state("simple",{url:"/simple/:mode",templateUrl:"app/modules/core/views/play.html",controller:"PlayController as vm"}).state("flash",{url:"/flash/:mode",templateUrl:"app/modules/core/views/flash.html",controller:"FlashController as vm"}).state("howToPlay",{url:"/howToPlay",templateUrl:"app/modules/core/views/howToPlay.html"})}e.$inject=["$logProvider","configConstantes"],a.$inject=["$stateProvider","$urlRouterProvider"],angular.module("xflip").config(e).config(a)}(),angular.module("xflip").run(["$templateCache",function(e){e.put("app/modules/core/views/flash.html",'<div class="play-page flash"><div class="header"><div class="btn-return" ng-click="mainCtrl.goToState(\'home\'); mainCtrl.clickSound()">Menu</div><div class="hearts pull-right" ng-class="{\'timeLeft\': vm.timeLeft}">{{vm.count.min}}:<span ng-if="vm.count.s < 10">0</span>{{vm.count.s}}</div></div><div class="score-wrapper"><div class="title">{{vm.TitleScore}}</div><div class="score">{{vm.score}}</div></div><div class="main-game row"><div class="col-xs-{{vm.mode.cards}} card-wrapper" ng-repeat="(index, card) in vm.cards track by index"><div class="card number{{card.value}} {{card.state}}-card" ng-click="vm.cardClicked(index)" ng-class="{\'numberSmall\' : card.value > 10000}"><span ng-if="card.state != \'hide\'"><span>{{card.value}}</span> <span ng-if="!!card.notif" class="notif">{{card.notif + \'s\'}}</span></span></div></div></div><div class="modal-wrapper bounceInRight" ng-if="vm.lose"><div class="FlipModal"><div class="modal-title">Time out !</div><div class="modal-content"><p>Your score is : {{vm.score}}</p></div><div class="modal-footer row"><div class="col-xs-6"><div class="btn btn-yellow" ng-click="mainCtrl.goToState(\'home\')">Menu</div></div><div class="col-xs-6"><div class="btn btn-blue" ng-click="vm.init()">Try Again</div></div></div></div></div></div>'),e.put("app/modules/core/views/home.html",'<div class="menu-page"><div class="logo"><img src="assets/images/logo.png" alt="logo" ng-show="vm.showLogo"><div class="close-btn" ng-click="mainCtrl.close(false); mainCtrl.clickSound()"></div></div><div class="btns"><div class="simple col-xs-6" ng-click="vm.showLevels(\'simple\'); mainCtrl.clickSound()"><div class="btn-wrapper"><i class="play-icon"></i><p>Simple Mode</p></div></div><div class="flash col-xs-6" ng-click="vm.showLevels(\'flash\'); mainCtrl.clickSound()"><div class="btn-wrapper"><i class="chrono-icon"></i><p>Flash Mode</p></div></div></div><div class="home-content"><div class="score row"><div class="col-xs-12">High Score</div><div class="col-xs-6">Simple Mode <span>{{vm.score}}</span></div><div class="col-xs-6">Flash Mode <span>{{vm.scoreFlash}}</span></div></div></div><div class="footer"><div class="col-xs-4"><div class="help" ng-click="mainCtrl.goToState(\'howToPlay\'); mainCtrl.clickSound()"></div></div><div class="col-xs-4 text-center" ng-click="toggleSound(); mainCtrl.clickSound()"><div class="sound" ng-class="{\'soundOff\':!sound}"></div></div><div class="col-xs-4 text-right"><div class="classement"></div></div></div><div class="modal-wrapper" ng-if="vm.showLevel != \'\'"><div class="FlipModal"><div class="modal-content row"><div class="col-xs-4 card-wrapper"><div class="card" ng-class="{\'hide-card\': vm.hideCard === \'easy\'}" ng-click="vm.startGame(vm.showLevel,\'easy\')"><span>Easy</span></div></div><div class="col-xs-4 card-wrapper"><div class="card" ng-class="{\'hide-card\': vm.hideCard === \'medium\'}" ng-click="vm.startGame(vm.showLevel,\'medium\')"><span>Meduim</span></div></div><div class="col-xs-4 card-wrapper"><div class="card" ng-class="{\'hide-card\': vm.hideCard === \'hard\'}" ng-click="vm.startGame(vm.showLevel,\'hard\')"><span>Hard</span></div></div></div><div class="modal-footer row"><div class="col-xs-12"><div class="btn btn-blue" ng-click="vm.showLevel=\'\'; mainCtrl.clickSound()">Close</div></div></div></div></div></div>'),e.put("app/modules/core/views/howToPlay.html",'<div class="play-page howToPlay"><div class="header"><div class="btn-return" ng-click="mainCtrl.goToState(\'home\'); mainCtrl.clickSound()">Menu</div></div><div class="title">How To Play</div><div class="desc">Find two cards with the same number to get the sum, You have only 3 chances :)</div><ul class="list"><li class="row"><img src="assets/images/tuto/tuto1.png" class="col-xs-4"><p class="col-xs-8">Two cards with the same number gives the sum</p></li><li class="row"><img src="assets/images/tuto/tuto2.png" class="col-xs-4"><p class="col-xs-8">Joker card can be used with any card</p></li><li class="row"><img src="assets/images/tuto/tuto3.png" class="col-xs-4"><p class="col-xs-8">Shuffle card mix all your cards</p></li><li class="row"><img src="assets/images/tuto/tuto4.png" class="col-xs-4"><p class="col-xs-8">Give you more time in Flash Mode</p></li></ul></div>'),e.put("app/modules/core/views/play.html",'<div class="play-page"><div class="header"><div class="btn-return" ng-click="mainCtrl.goToState(\'home\'); mainCtrl.clickSound()">Menu</div><div class="hearts pull-right">{{vm.hearts}} <i class="heart-icon"></i></div></div><div class="score-wrapper"><div class="title">{{vm.TitleScore}}</div><div class="score">{{vm.score}}</div></div><div class="main-game row"><div class="col-xs-{{vm.mode.cards}} card-wrapper" ng-repeat="(index, card) in vm.cards track by index"><div class="card number{{card.value}} {{card.state}}-card" ng-click="vm.cardClicked(index)" ng-class="{\'numberSmall\' : card.value > 10000}"><span ng-if="card.state != \'hide\'">{{card.value}}</span></div></div></div><div class="bottom text-uppercase"><div class="btn-help col-xs-6" ng-click="vm.showOneFct(); mainCtrl.clickSound()" ng-class="{\'showOne\': vm.showOne}">Show One <sup class="indict">{{vm.showOneDiamonds}}</sup></div><div class="btn-help col-xs-6" ng-click="vm.showAllFct(false); mainCtrl.clickSound()">Show All <sup class="indict">{{vm.showAllDiamonds}}</sup></div></div><div class="modal-wrapper bounceInRight" ng-if="vm.lose"><div class="FlipModal"><div class="modal-title">You lose !</div><div class="modal-content"><p ng-if="vm.heartsDiamonds == 0">Sorry, you don\'t have more hearts :(</p><div ng-if="vm.heartsDiamonds == 1" class="continue-wrapper"><p>Do you want to use your last heart ?</p><div class="btn btn-continue" ng-click="vm.continueFct(); mainCtrl.clickSound()">Continue</div></div><div ng-if="vm.heartsDiamonds > 1" class="continue-wrapper"><p>Do you want to use one of your hearts ?</p><div class="btn btn-continue" ng-click="vm.continueFct(); mainCtrl.clickSound()">Continue</div></div></div><div class="modal-footer row"><div class="col-xs-6"><div class="btn btn-yellow" ng-click="mainCtrl.goToState(\'home\'); mainCtrl.clickSound()">Menu</div></div><div class="col-xs-6"><div class="btn btn-blue" ng-click="vm.init(); mainCtrl.clickSound()">Try Again</div></div></div></div></div><div class="modal-wrapper showAll" ng-if="vm.showAll"><div class="FlipModal"><div class="modal-title">Show All Cards !</div><div class="modal-content"><p>Are you sure you want to show all cards for 2 seconds ?</p></div><div class="modal-footer row"><div class="col-xs-6"><div class="btn btn-red" ng-click="vm.showAll=false; mainCtrl.clickSound()">No</div></div><div class="col-xs-6"><div class="btn btn-blue" ng-click="vm.showAllFct(true); mainCtrl.clickSound()">Yes</div></div></div></div></div><div class="infoWindow" ng-if="vm.infoWindow.show">{{vm.infoWindow.content}}</div></div>')}]);